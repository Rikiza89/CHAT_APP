<!-- templates/chat/create_chat.html -->
{% extends 'base.html' %}

{% block title %}Create Chat{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px; margin-top: 30px;">
    <div style="background: white; padding: 40px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h1 style="margin-bottom: 30px;">Start New Chat</h1>
        
        <form method="post">
            {% csrf_token %}
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Chat Type</label>
                <select name="room_type" id="room-type" 
                        style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                    <option value="direct">Direct Message</option>
                    <option value="group">Group Chat</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;" id="group-name-field" style="display: none;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Group Name</label>
                <input type="text" name="name" 
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 15px; font-weight: 500;">Select Users</label>
                <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px;">
                    {% for user_item in users %}
                        <label style="display: flex; align-items: center; padding: 10px; border-radius: 6px; 
                                      cursor: pointer; transition: background 0.2s;" class="user-checkbox">
                            <input type="checkbox" name="users" value="{{ user_item.id }}" class="user-select"
                                   style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                            <div style="width: 36px; height: 36px; border-radius: 50%; background: #007bff; 
                                        color: white; display: flex; align-items: center; justify-content: center; 
                                        font-weight: bold; margin-right: 12px;">
                                {{ user_item.username|first|upper }}
                            </div>
                            <div>
                                <div style="font-weight: 500;">{{ user_item.username }}</div>
                                <div style="font-size: 0.85rem; color: #666;">{{ user_item.email }}</div>
                            </div>
                        </label>
                    {% endfor %}
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Create Chat</button>
                <a href="{% url 'chat:chat_list' %}" class="btn btn-outline">Cancel</a>
            </div>
        </form>
    </div>
</div>

<style>
    .user-checkbox:hover {
        background: #f8f9fa;
    }
</style>

<script>
    const roomType = document.getElementById('room-type');
    const groupNameField = document.getElementById('group-name-field');
    const userCheckboxes = document.querySelectorAll('.user-select');
    
    roomType.addEventListener('change', function() {
        if (this.value === 'group') {
            groupNameField.style.display = 'block';
        } else {
            groupNameField.style.display = 'none';
            // For direct message, allow only one selection
            userCheckboxes.forEach(cb => {
                if (!cb.checked) {
                    cb.addEventListener('change', function() {
                        if (roomType.value === 'direct') {
                            userCheckboxes.forEach(other => {
                                if (other !== this) other.checked = false;
                            });
                        }
                    });
                }
            });
        }
    });
    
    // Trigger initial state
    roomType.dispatchEvent(new Event('change'));
</script>
{% endblock %}